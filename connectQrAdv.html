<!DOCTYPE html>
<html>
<head>
  <title>Enhanced QR Scanner with html5-qrcode</title>
  <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
  <style>
    #reader { width: 100%; max-width: 400px; height: 300px; }
  </style>
</head>
<body>
  <h2>QR Code Scanner with Enhanced Settings</h2>
  <div id="reader"></div>
  <div id="status"></div>
  <pre id="result"></pre>

  <script>
    const statusDiv = document.getElementById('status');
    const resultPre = document.getElementById('result');

    // Initialize scanner
    const html5QrcodeScanner = new Html5Qrcode("reader");

    function updateStatus(msg) {
      statusDiv.textContent = msg;
    }

    function displayResult(text) {
      resultPre.textContent = text;
      setTimeout(() => { resultPre.textContent = ''; }, 8000);
    }

    function onScanSuccess(decodedText, decodedResult) {
      updateStatus("QR Code detected!");
      displayResult(decodedText);
      html5QrcodeScanner.pause();
      // Handle the scanned data here or resume scan if needed: html5QrcodeScanner.resume();
    }

    function onScanError(errorMessage) {
      // No console spam: comment out in production
      // console.log("Error scanning: ", errorMessage);
    }

    // Start scanning with optimized config
    html5QrcodeScanner.start(
      { facingMode: { exact: "environment" } }, // Use back camera
      {
        fps: 20,                   // Higher fps for smoother scan
        qrbox: { width: 280, height: 280 },
        aspectRatio: 1.25,
        disableFlip: false,
        experimentalFeatures: {
          useBarCodeDetectorIfSupported: true // Use native barcode detector if supported for better perf
        },
        verbose: false
      },
      onScanSuccess,
      onScanError
    ).then(() => {
      updateStatus("Scanner started, point camera at QR Code.");
    }).catch(err => {
      updateStatus("Failed to start scanner: " + err);
    });

    // Optionally, stop scanner after some time or on user interaction
    // setTimeout(() => html5QrcodeScanner.stop(), 60000);
  </script>
</body>
</html>
